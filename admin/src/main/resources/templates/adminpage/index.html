<!DOCTYPE html>
<html>
	<!--head ì‹œì‘ -->
	<div th:replace="fragment/adminhead :: head"></div>
	<!-- chart.js cdn -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
	<!--head ë -->
	<body>

		<!-- header ì‹œì‘ -->
		<div th:replace="fragment/adminheader :: header(${sessionInfo})"></div>
		<!-- header ë -->
		<!-- right-sidebar ì‹œì‘ -->
		<div th:replace="fragment/adminrightsidebar :: rightsidebar"></div>
		<!-- right-sidebar ë -->
		<!-- left-side-bar ì‹œì‘ -->
		<div th:replace="fragment/adminnavbar :: navbar"></div>
		<!-- left-side-bar ë -->

		<div class="main-container">
			<div class="pd-ltr-20">
				<div class="row">
					<div class="col-xl-3 mb-30">
						<div class="card-box height-100-p widget-style1">
							<div class="d-flex flex-wrap align-items-center">
								<div class="progress-data">
									<div id="chart"><img src="/img/admin/user.png"/></div>
								</div>
								<div class="widget-data">
									<div class="h4 mb-0" id="userCount">2020</div>
									<div class="weight-600 font-14">user</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 mb-30">
						<div class="card-box height-100-p widget-style1">
							<div class="d-flex flex-wrap align-items-center">
								<div class="progress-data">
									<div id="chart2"><img src="/img/admin/product.png"/></div>
								</div>
								<div class="widget-data">
									<div class="h4 mb-0" id="productCount">42345</div>
									<div class="weight-600 font-14">product</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 mb-30">
						<div class="card-box height-100-p widget-style1">
							<div class="d-flex flex-wrap align-items-center">
								<div class="progress-data">
									<div id="chart3"><img src="/img/admin/board.png"/></div></div>
								<div class="widget-data">
									<div class="h4 mb-0" id="feedCount">350</div>
									<div class="weight-600 font-14">feed</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-3 mb-30">
						<div class="card-box height-100-p widget-style1">
							<div class="d-flex flex-wrap align-items-center">
								<div class="progress-data">
									<div id="chart4"><img src="/img/admin/conclusion.png"/></div>
								</div>
								<div class="widget-data">
									<div class="h4 mb-0" id="conclusionCount">1940</div>
									<div class="weight-600 font-14">conclusion</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<!-- ê·¸ë˜í”„ -->
					<div class="col-xl-8 mb-30">
						<div class="card-box height-100-p pd-20">
							<h2 class="h4 mb-20">sales</h2>
<!--							<div id="chart5"></div>-->
							<div class="graph">
								<canvas id="graph" width="700" height="400" style="display: block; margin: 0 auto;"></canvas>
							</div>
						</div>
					</div>
					<!-- ì¸ê¸° ìŠ¤íƒ€ì¼ ê²Œì‹œê¸€ -->
					<div class="col-xl-4 mb-30">
						<div class="card-box height-100-p pd-20">
							<div>
								<h2 class="h4 mb-20" style="float: left;">top posting</h2>
								<div class="replyCnt" style="width: 30px; float: right; display: flex; margin-right: 15px;">
									<img src="/img/styleImg/comment_icon.png"/>
									<div style="padding-left: 5px; font-weight: bold;">cnt</div>
								</div>
								<div class="likeCnt" style="width: 30px; float: right; display: flex; margin-right: 30px;">
									<img src="/img/styleImg/like_icon.png"/>
									<div style="padding-left: 5px; font-weight: bold;">cnt</div>
								</div>
							</div>
							<div id="chart6"><img src="/img/styleImg/feed1.jpeg"></div>
						</div>
					</div>
				</div>
				<div class="card-box mb-30">
					<h2 class="h4 pd-20">Best Selling Products Top 10</h2>
					<table class="data-table table nowrap">
						<thead>
						<tr>
							<th class="table-plus datatable-nosort">ìƒí’ˆì‚¬ì§„</th>
							<th>ìƒí’ˆëª…</th>
							<th>ì‚¬ì´ì¦ˆ</th>
							<th>ê±°ë˜ìˆ˜</th>
							<th>ì´ê±°ë˜ì•¡</th>
						</tr>
						</thead>
						<tbody>
						<tr>
							<td class="table-plus">
								<img
										src="vendors/images/northface.png"
										width="140"
										height="140"
										alt=""
								/>
							</td>
							<td>
								<h5 class="font-16">The North Face 1996 Eco Nuptse Jacket Black</h5>
								ë…¸ìŠ¤í˜ì´ìŠ¤ 1996 ì—ì½” ëˆ•ì‹œ ìì¼“ ë¸”ë™
							</td>
							<td>100</td>
							<td>3</td>
							<td>730,000ì›</td>

						</tr>
						<tr>
							<td class="table-plus">
								<img
										src="vendors/images/nike.png"
										width="140"
										height="140"
										alt=""
								/>
							</td>
							<td>
								<h5 class="font-16">
									Jordan 1 Retro High OG Chicago 2022</h5>
								ì¡°ë˜ 1 ë ˆíŠ¸ë¡œ í•˜ì´ OG ì‹œì¹´ê³  2022
							</td>
							<td>270</td>
							<td>1</td>
							<td>425,000</td>

						</tr>
						<tr>
							<td class="table-plus">
								<img
										src="vendors/images/apple.png"
										width="140"
										height="140"
										alt=""
								/>
							</td>
							<td>
								<h5 class="font-16">Apple AirPods Max Silver (Korean Ver.)</h5>
								ì• í”Œ ì—ì–´íŒŸ ë§¥ìŠ¤ ì‹¤ë²„ (êµ­ë‚´ ì •ì‹ ë°œë§¤ ì œí’ˆ)
							</td>
							<td>ONE SIZE</td>

							<td>10</td>
							<td>6,752,000ì›</td>
						</tr>
						<tr>
							<td class="table-plus">
								<img
										src="vendors/images/ugg.png"
										width="140"
										height="140"
										alt=""
								/>
							</td>
							<td>
								<h5 class="font-16">(W) UGG Classic Mini II Boots Chestnut</h5>
								(W) ì–´ê·¸ í´ë˜ì‹ ë¯¸ë‹ˆ 2 ë¶€ì¸  ì²´ìŠ¤íŠ¸ë„›
							</td>
							<td>230</td>
							<td>2</td>
							<td>580,000</td>
						</tr>
						<tr>
							<td class="table-plus">
								<img
										src="vendors/images/ader.png"
										width="140"
										height="140"
										alt=""
								/>
							</td>
							<td>
								<h5 class="font-16">Ader Error x Zara Patchwork Oversize Knit Sweater Multicolor</h5>
								ì•„ë”ì—ëŸ¬ x ìë¼ íŒ¨ì¹˜ì›Œí¬ ì˜¤ë²„ì‚¬ì´ì¦ˆ ë‹ˆíŠ¸ ìŠ¤ì›¨í„° ë©€í‹°ì»¬ëŸ¬
							</td>
							<td>M</td>
							<td>1</td>
							<td>270,000</td>
						</tr>
						</tbody>
					</table>

				</div>
				
			</div>
		</div>

		<script src="vendors/scripts/core.js"></script>
		<script src="vendors/scripts/script.min.js"></script>
		<script src="vendors/scripts/process.js"></script>
		<script src="vendors/scripts/layout-settings.js"></script>
		<script src="src/plugins/apexcharts/apexcharts.min.js"></script>
<!--		<script src="vendors/scripts/dashboard.js"></script>-->
		<script th:inline="javascript">
			/*<![CDATA[*/
			let conclusion = [[${conclusion}]];
			// console.log(conclusion);
			let sale = [[${sale}]];
			// console.log(sale);

			let now = new Date();
			let oneyear = new Date();

			function dateFormat(date) {
				let dateFormat = date.getFullYear() +
						'-' + ( (date.getMonth()+1) < 9 ? "0" + (date.getMonth()+1) : (date.getMonth()+1) )
				return dateFormat;
			}

			let nowDate = dateFormat(new Date());
			console.log("í˜„ì¬: " + nowDate);

			let oneYearAgo = dateFormat(new Date(oneyear.setFullYear(oneyear.getFullYear() - 1)));
			console.log("ì¼ë…„ì „: " + oneYearAgo);

			// ğŸ“Œ date -> conclusion total count
			let arr1 = [];
			for(let key in conclusion) {
				arr1.push([conclusion[key].createdAt.substring(0, 7)]); // yyyy-mm ìœ¼ë¡œ í¬ë§· ë³€ê²½
			}
			// console.log(arr1);

			let arr2 = [];
			for(let i=0; i<arr1.length; i++){
				if(arr1[i][0] >= oneYearAgo){ // 1ë…„ì „ ë‚ ì§œë§Œ
					arr2.push(arr1[i][0]);
				}
			}
			// console.log(arr2);

			function getCount(array) {
				return array.reduce((pv, cv)=>{ // pv=keyê°’ìœ¼ë¡œ ë‚ ì§œ, cv=valueê°’ìœ¼ë¡œ ì¹´ìš´íŠ¸
					pv[cv] = (pv[cv] || 0) + 1; // ìë°”ìŠ¤í¬ë¦½íŠ¸ ë‹¨ì¶•í‰ê°€
					return pv;
				}, {});
			}
			getCount(arr2);
			// console.log(getCount(arr2));

			let arr3 = [];
			arr3 = Object.entries(getCount(arr2)); // object -> arrayë¡œ ë³€ê²½

			// ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
			arr3 = arr3.sort(function compare(a, b) {
					let dateA = new Date(a[0]).getTime();
					let dateB = new Date(b[0]).getTime();
					return dateA > dateB ? 1 : -1;
				});
			// console.log(arr3);

			let Date1 = [];
			let Count1 = [];
			for(let i = 0; i<arr3.length; i++){
				Date1.push(arr3[i][0]);
				Count1.push(arr3[i][1]);
			}
			console.log(Date1);
			console.log(Count1);


			// ğŸ“Œ date -> conclusion total price
			let arr4 = [];
			for(let key in sale) {
				arr4.push([sale[key].createdAt.substring(0, 7), sale[key].price.replaceAll(",","").replace("ì›","").substring()]); // yyyy-mm ìœ¼ë¡œ í¬ë§· ë³€ê²½
			}
			// console.log(arr4);

			let Price1  = [];
			for(let i = 0; i<arr4.length; i++){
				Price1.push(arr4[i][1]);
			}
			console.log(Price1);


			let graphData = {
				labels: Date1, // xì¶•
				datasets: [{
					type: "bar",
					label: "total count",
					data: Count1, // yì¶• 1 -> í•œë‹¬ ì²´ê²°ë‚´ì—­ í† íƒˆ ì¹´ìš´íŠ¸
					yAxisID: 'y-left',
					backgroundColor: 'rgb(21,20,189)', // ì°¨íŠ¸ ë°°ê²½ ìƒ‰
					borderColor: 'rgb(21,20,189)', // ë¼ì¸ ìƒ‰
					borderWidth: 1, // ë¼ì¸ ë„“ì´
					pointRadius: 0, // í¬ì¸í„° ì—†ì• ê¸°,
				},{
					label: "total price",
					data: Price1, // yì¶• 2 -> í•œë‹¬ ì²´ê²°ë‚´ì—­ í† íƒˆ ê¸ˆì•¡
					type: "bar",
					yAxisID: 'y-right',
					backgroundColor: 'rgb(101,150,70)', // ì°¨íŠ¸ ë°°ê²½ ìƒ‰
					borderColor: 'rgb(101,150,70)', // ë¼ì¸ ìƒ‰
					borderWidth: 1, // ë¼ì¸ ë„“ì´
					pointRadius: 0, // í¬ì¸í„° ì—†ì• ê¸°
				}]
			};

			let graphOptions = {
				maxBarThickness: 30,
				responsive: false, // ì‚¬ì´ì¦ˆ ìë™ ì¡°ì ˆ ê°€ëŠ¥ ì—¬ë¶€
				scales: {
					x: {
						title: {
							display: true,
						}
					},
					"y-right": {
						type: 'linear',
						position: 'right',
						title: {
							display: true,
						},
						grid: {
							display: false
						},
						// ticks: {
						// 	callback: function(value, index, values) {
						// 		return value + ' ì›';
						// 	}
						// }
					},
					"y-left": {
						type: 'linear',
						position: 'left',
						title: {
							display: true,
						},
						grid: {
							display: false
						}
					},
				}
			};

			let myChart;
			window.addEventListener('DOMContentLoaded', function() {
				let ctx = document.getElementById("graph").getContext("2d");
				myChart = new Chart(ctx, {
					type: "bar",
					data: graphData,
					options: graphOptions
				});
			});

			/*]]>*/
		</script>
	</body>
</html>
